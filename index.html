<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Leaflet Map</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />
  <style>
    html, body { height: 100%; margin: 0; padding: 0; }
    #map { height: 100%; }
    .search-box {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 1000;
      background: white;
      padding: 6px;
      border-radius: 6px;
      box-shadow: 0 0 5px rgba(0,0,0,0.3);
    }
    .leaflet-control-zoom {
      left: 10px !important;
      right: auto !important;
    }
  </style>
</head>
<body>
  <div class="search-box">
    <input type="text" id="searchInput" placeholder="æ¤œç´¢..." />
  </div>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <script>
    const map = L.map('map', {
      zoomControl: true
    }).setView([36.29170298,139.73511565], 15);

    // æ‹¡å¤§ç¸®å°ãƒœã‚¿ãƒ³ã®ä½ç½®ã‚’å·¦ä¸‹ã«
    map.zoomControl.setPosition('bottomleft');

    // èƒŒæ™¯åœ°å›³
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Â© OpenStreetMap contributors'
    }).addTo(map);

    // æ¤œç´¢å¯¾è±¡ãƒ•ã‚£ãƒ¼ãƒãƒ£ã®ä¿å­˜ç”¨
    let searchableLayers = [];
    let overlayMaps = {};

    function createPopup(feature) {
      let content = '';
      for (const key in feature.properties) {
        content += `<strong>${key}:</strong> ${feature.properties[key]}<br>`;
      }
      return content;
    }

    // æ±ç”¨ãƒ¬ã‚¤ãƒ¤èª­ã¿è¾¼ã¿é–¢æ•°ï¼ˆãƒ¬ã‚¤ãƒ¤ã®é †ç•ªã«æ³¨æ„ï¼‰
    function loadLayer(file, layerName, style = {}, labelField = null, pointLayer = false) {
      fetch(file)
        .then(res => res.json())
        .then(data => {
          const layer = L.geoJSON(data, {
            style: style,
            onEachFeature: function (feature, layer) {
              if (labelField && feature.properties[labelField]) {
                layer.bindTooltip(feature.properties[labelField], {
                  permanent: true,
                  direction: 'right',
                  className: 'feature-label'
                });
              }

              searchableLayers.push({ name: feature.properties[labelField || 'name'], layer });

              layer.on('click', function () {
                layer.bindPopup(createPopup(feature)).openPopup();
              });
            },
            pointToLayer: function (feature, latlng) {
              return L.circleMarker(latlng, {
                radius: 6,
                fillColor: style.fillColor || "#000",
                color: style.color || "#000",
                weight: 1,
                opacity: 1,
                fillOpacity: style.fillOpacity || 0.8
              });
            }
          });

          layer.addTo(map);
          overlayMaps[layerName] = layer;
        });
    }

    // åœ°ç•ªç¢ºèª
    loadLayer("chiban.geojson", "åœ°ç•ªç¢ºèª", {
      color: "blue",
      fillColor: "white",
      fillOpacity: 0.5
    });

    // å¤§å­—å¢ƒç•Œï¼ˆå¤–éƒ­ã®ã¿ï¼‰
    loadLayer("oaza.geojson", "å¤§å­—å¢ƒç•Œ", {
      color: "#ff01e6",
      weight: 2,
      fillOpacity: 0
    });

    // é–‹æ°´è·¯ï¼ˆPP1_C02æ¡ä»¶ä»˜ãè‰²åˆ†ã‘ï¼‰
    fetch("kaisuiro.geojson")
      .then(res => res.json())
      .then(data => {
        const layer = L.geoJSON(data, {
          style: feature => {
            const val = feature.properties.PP1_C02;
            let color = "#000";
            if (val === "005") color = "orange";
            else if (val === "006") color = "#01ffea";
            return { color };
          },
          onEachFeature: (feature, layer) => {
            searchableLayers.push({ name: feature.properties.name, layer });
            layer.on('click', () => {
              layer.bindPopup(createPopup(feature)).openPopup();
            });
          }
        });

        layer.addTo(map);
        overlayMaps["é–‹æ°´è·¯"] = layer;
      });

    // åˆ†æ°´å·¥ãƒ»é ­é¦–å·¥ï¼ˆãƒ©ãƒ™ãƒ«ã‚ã‚Šï¼‰
    loadLayer("bunsuiko_toshuko.geojson", "åˆ†æ°´å·¥ãƒ»é ­é¦–å·¥", {
      color: "green",
      fillColor: "green",
      fillOpacity: 0.7
    }, "åç§°", true);

    // æšæ°´æ©Ÿå ´ï¼ˆãƒ©ãƒ™ãƒ«ã‚ã‚Šã€ãƒ”ãƒ³è¡¨ç¤ºï¼‰
    loadLayer("yosuiki.geojson", "æšæ°´æ©Ÿå ´", {
      color: "lightgreen",
      fillColor: "lightgreen",
      fillOpacity: 0.7
    }, "æ©Ÿå ´å", true);

    // ğŸ”æ¤œç´¢æ©Ÿèƒ½ï¼ˆå†…éƒ¨ä¸€è‡´ï¼‹è¡¨ç¤ºä¸­ãƒ¬ã‚¤ãƒ¤é™å®šï¼‰
    document.getElementById("searchInput").addEventListener("input", function () {
      const keyword = this.value.trim().toLowerCase();
      searchableLayers.forEach(({ name, layer }) => {
        if (!map.hasLayer(layer)) return; // è¡¨ç¤ºä¸­ã®ãƒ¬ã‚¤ãƒ¤ã®ã¿
        if (!keyword || (name && name.toLowerCase().includes(keyword))) {
          layer.setStyle && layer.setStyle({ opacity: 1, fillOpacity: 0.7 });
          if (layer._path) layer._path.style.display = '';
        } else {
          if (layer._path) layer._path.style.display = 'none';
        }
      });
    });

    // âœ… ãƒ¬ã‚¤ãƒ¤é¸æŠï¼ˆãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ï¼‰
    const layerControl = L.control.layers(null, overlayMaps, { collapsed: false }).addTo(map);
  </script>
</body>
</html>