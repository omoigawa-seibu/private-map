<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Leaflet Map</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    html, body, #map {
      height: 100%;
      margin: 0;
      padding: 0;
    }
    .search-box {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 1000;
      background: white;
      padding: 6px;
      border-radius: 4px;
      box-shadow: 0 0 5px rgba(0,0,0,0.3);
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <div class="search-box">
    <input type="text" id="searchInput" placeholder="æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰">
    <button onclick="searchFeatures()">æ¤œç´¢</button>
  </div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <script>
    const map = L.map('map').setView([36.3, 139.2], 13);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19
    }).addTo(map);

    // --- å„ãƒ¬ã‚¤ãƒ¤èª­ã¿è¾¼ã¿ã¨ã‚¹ã‚¿ã‚¤ãƒ«è¨­å®š ---
    // â‘  åˆ†æ°´å·¥ãƒ»é ­é¦–å·¥
    const bunsuikoLayer = L.geoJSON(null, {
      pointToLayer: (feature, latlng) => {
        return L.circleMarker(latlng, {
          radius: 6,
          color: "green",
          fillColor: "green",
          fillOpacity: 1
        }).bindTooltip(feature.properties.åç§°, { permanent: true, direction: 'right' })
          .bindPopup(popupContent(feature));
      }
    });
    fetch("bunsuiko_toshuko.geojson").then(res => res.json()).then(data => bunsuikoLayer.addData(data));

    // â‘¡ æšæ°´æ©Ÿå ´
    const yosuikiLayer = L.geoJSON(null, {
      pointToLayer: (feature, latlng) => {
        return L.circleMarker(latlng, {
          radius: 6,
          color: "#99cc00",
          fillColor: "#99cc00",
          fillOpacity: 1
        }).bindTooltip(feature.properties.æ©Ÿå ´å, { permanent: true, direction: 'right' })
          .bindPopup(popupContent(feature));
      }
    });
    fetch("yosuiki.geojson").then(res => res.json()).then(data => yosuikiLayer.addData(data));

    // â‘¢ é–‹æ°´è·¯
    const kaisuiroLayer = L.geoJSON(null, {
      style: {
        color: "orange",
        weight: 3
      },
      onEachFeature: (feature, layer) => {
        layer.bindPopup(popupContent(feature));
      }
    });
    fetch("kaisuiro.geojson").then(res => res.json()).then(data => kaisuiroLayer.addData(data));

    // â‘£ å¤§å­—å¢ƒç•Œ
    const oazaLayer = L.geoJSON(null, {
      style: {
        color: "#ff01e6",
        weight: 2,
        fillOpacity: 0
      },
      onEachFeature: (feature, layer) => {
        layer.bindPopup(popupContent(feature));
      }
    });
    fetch("oaza.geojson").then(res => res.json()).then(data => oazaLayer.addData(data));

    // â‘¤ åœ°ç•ªç¢ºèª
    const chibanLayer = L.geoJSON(null, {
      style: {
        color: "blue",
        fillColor: "white",
        weight: 1,
        fillOpacity: 0.5
      },
      onEachFeature: (feature, layer) => {
        layer.bindPopup(popupContent(feature));
      }
    });
    fetch("chiban.geojson").then(res => res.json()).then(data => chibanLayer.addData(data));

    // --- ãƒ¬ã‚¤ãƒ¤é †è¨­å®šï¼ˆä¸‹ã‹ã‚‰é †ã«è¿½åŠ ï¼‰ ---
    chibanLayer.addTo(map);
    oazaLayer.addTo(map);
    kaisuiroLayer.addTo(map);
    yosuikiLayer.addTo(map);
    bunsuikoLayer.addTo(map);

    // --- ãƒ¬ã‚¤ãƒ¤è¡¨ç¤ºã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ï¼ˆè¡¨ç¤ºé †ã‚’é€†ã«ã™ã‚‹ï¼‰ ---
    const overlays = {
      "åˆ†æ°´å·¥ãƒ»é ­é¦–å·¥": bunsuikoLayer,
      "æšæ°´æ©Ÿå ´": yosuikiLayer,
      "é–‹æ°´è·¯": kaisuiroLayer,
      "å¤§å­—å¢ƒç•Œ": oazaLayer,
      "åœ°ç•ªç¢ºèª": chibanLayer
    };
    L.control.layers(null, overlays, { position: 'topright', collapsed: false }).addTo(map);

    // --- GPSãƒœã‚¿ãƒ³ ---
    const gpsControl = L.control({ position: 'bottomright' });
    gpsControl.onAdd = function () {
      const div = L.DomUtil.create('div', 'leaflet-bar');
      const button = L.DomUtil.create('a', '', div);
      button.innerHTML = 'ðŸ“GPS';
      button.href = '#';
      button.title = 'ç¾åœ¨åœ°ã‚’è¡¨ç¤º';
      L.DomEvent.on(button, 'click', function (e) {
        L.DomEvent.preventDefault(e);
        map.locate({ setView: true, maxZoom: 16 });
      });
      return div;
    };
    gpsControl.addTo(map);

    // --- æ‹¡å¤§ãƒ»ç¸®å°ãƒœã‚¿ãƒ³ å·¦ä¸‹é…ç½® ---
    L.control.zoom({ position: 'bottomleft' }).addTo(map);

    // --- æ¤œç´¢æ©Ÿèƒ½ï¼ˆå†…éƒ¨ä¸€è‡´ï¼‹è¡¨ç¤ºä¸­ãƒ¬ã‚¤ãƒ¤ã®ã¿ï¼‰ ---
    function searchFeatures() {
      const keyword = document.getElementById("searchInput").value.trim();
      if (!keyword) return;

      const allLayers = [bunsuikoLayer, yosuikiLayer, kaisuiroLayer, oazaLayer, chibanLayer];
      let found = false;

      allLayers.forEach(layerGroup => {
        if (!map.hasLayer(layerGroup)) return;

        layerGroup.eachLayer(layer => {
          const props = layer.feature?.properties;
          if (!props) return;

          for (const key in props) {
            const value = props[key];
            if (typeof value === 'string' && value.includes(keyword)) {
              layer.openPopup();
              map.fitBounds(layer.getBounds ? layer.getBounds() : L.latLng(layer.getLatLng()), { maxZoom: 17 });
              found = true;
              return;
            }
          }
        });
      });

      if (!found) {
        alert("è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚");
      }
    }

    // --- è©³ç´°ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—å…±é€šé–¢æ•° ---
    function popupContent(feature) {
      const props = feature.properties;
      return Object.keys(props)
        .map(key => `<strong>${key}</strong>: ${props[key]}`)
        .join("<br>");
    }
  </script>
</body>
</html>